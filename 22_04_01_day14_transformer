{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"22_04_01_day14_transformer","provenance":[],"collapsed_sections":[],"authorship_tag":"ABX9TyNDzr5Vv4gmaGrHdiK3crvY"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"df845705580c4ca397c0e6b15c4ede17":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_75f401ec998d425e93fbd8a2f6473d4d","IPY_MODEL_f6d772632cc44df0a682a3b8c2261c1d","IPY_MODEL_4345b9211b544f74a10a1b44c8b28575"],"layout":"IPY_MODEL_3f59d39dd8464c6d892f27960913caaa"}},"75f401ec998d425e93fbd8a2f6473d4d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e1bdfc7d4a384f2c9199300fcac4de77","placeholder":"​","style":"IPY_MODEL_001d98363a8b4e23b73a4438935331d4","value":"100%"}},"f6d772632cc44df0a682a3b8c2261c1d":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_46121501ce734d4cbf8d445677ae4bdc","max":118964,"min":0,"orientation":"horizontal","style":"IPY_MODEL_d1d9f4ee11ef41d097fab56d12c4a448","value":118964}},"4345b9211b544f74a10a1b44c8b28575":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0712fd1cb1394dcc9a6880ccc2ed8101","placeholder":"​","style":"IPY_MODEL_9ed15da4adf948fc877a0fb01b8dd52c","value":" 118964/118964 [00:17&lt;00:00, 6554.76it/s]"}},"3f59d39dd8464c6d892f27960913caaa":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e1bdfc7d4a384f2c9199300fcac4de77":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"001d98363a8b4e23b73a4438935331d4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"46121501ce734d4cbf8d445677ae4bdc":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d1d9f4ee11ef41d097fab56d12c4a448":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0712fd1cb1394dcc9a6880ccc2ed8101":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9ed15da4adf948fc877a0fb01b8dd52c":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"916e070fe0ed47f2a2a694c32a7d5b38":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_303daa8d589f445aab2658bd1d47af2b","IPY_MODEL_0aff4e9c561a465fa71686a35fd577af","IPY_MODEL_85632387f7b041548f91e6994f37775d"],"layout":"IPY_MODEL_6e820d5cfd1c43349ac6e8c7b1d9a641"}},"303daa8d589f445aab2658bd1d47af2b":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_214c084865c74503aabcd3b415a39d99","placeholder":"​","style":"IPY_MODEL_92560677e502423a83f97f3f01142cbe","value":"Epoch  1: 100%"}},"0aff4e9c561a465fa71686a35fd577af":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_f5bab3ea55a5468eaa0fc31a8d117f7e","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_5a7f9e5bfe0f4fc1a4d264cf78c05275","value":1841}},"85632387f7b041548f91e6994f37775d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_1f03d0f898bf494ba20067dc2a870651","placeholder":"​","style":"IPY_MODEL_8435a250fc854d8d8b118b47370942d1","value":" 1841/1841 [10:46&lt;00:00,  2.92it/s, Loss 3.3336]"}},"6e820d5cfd1c43349ac6e8c7b1d9a641":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"214c084865c74503aabcd3b415a39d99":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"92560677e502423a83f97f3f01142cbe":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f5bab3ea55a5468eaa0fc31a8d117f7e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"5a7f9e5bfe0f4fc1a4d264cf78c05275":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"1f03d0f898bf494ba20067dc2a870651":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8435a250fc854d8d8b118b47370942d1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"52d7ce9b0de44774b5faf57c5d6963db":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_8a78b9f58da1407ab9bfe1949e160698","IPY_MODEL_4ae6caded9a04560b32439b1633fd74f","IPY_MODEL_d0164f64c59342ef8c9b732c06a912ff"],"layout":"IPY_MODEL_32f704952e364e7b9175cee4a8c44e55"}},"8a78b9f58da1407ab9bfe1949e160698":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0b6b7dea29db403e9d9ffb40c33e0238","placeholder":"​","style":"IPY_MODEL_833c0b499bd34ac097bf2d9ebc86f340","value":"Epoch  2: 100%"}},"4ae6caded9a04560b32439b1633fd74f":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_c3add340d0ac430cbb5bae1d07ae2f76","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_d62be91de4ca40b794084289d4a556db","value":1841}},"d0164f64c59342ef8c9b732c06a912ff":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_de3273560d3e452198ffa7b043954184","placeholder":"​","style":"IPY_MODEL_4644d48349d9475fa3a45f93e5a69acf","value":" 1841/1841 [10:33&lt;00:00,  2.89it/s, Loss 1.7823]"}},"32f704952e364e7b9175cee4a8c44e55":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0b6b7dea29db403e9d9ffb40c33e0238":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"833c0b499bd34ac097bf2d9ebc86f340":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"c3add340d0ac430cbb5bae1d07ae2f76":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d62be91de4ca40b794084289d4a556db":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"de3273560d3e452198ffa7b043954184":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4644d48349d9475fa3a45f93e5a69acf":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f9d479d62a194925a6e5fd0efe4ccf1f":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a47ea5036371470688b01909f292f25e","IPY_MODEL_e86edec5d17d4f0899e49809f8fb4552","IPY_MODEL_8abcaa7d448d464bbb3d47d38602007d"],"layout":"IPY_MODEL_2a80abea5e8e48ef8473ef0a758c2e81"}},"a47ea5036371470688b01909f292f25e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_7d193223c7a6407e9a116a48802fd7de","placeholder":"​","style":"IPY_MODEL_2bcc8cb48c1b49a9bfaff3c10c59c2e1","value":"Epoch  3: 100%"}},"e86edec5d17d4f0899e49809f8fb4552":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_a4c4e0e3250340758b0a336e8fbc5025","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_de934db9af534044a23a64cf2de29b68","value":1841}},"8abcaa7d448d464bbb3d47d38602007d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_4290061671244e4db7e351a206d68c62","placeholder":"​","style":"IPY_MODEL_feb8fe422d644c00b86c6a80ca173bdf","value":" 1841/1841 [10:24&lt;00:00,  2.96it/s, Loss 1.4877]"}},"2a80abea5e8e48ef8473ef0a758c2e81":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7d193223c7a6407e9a116a48802fd7de":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2bcc8cb48c1b49a9bfaff3c10c59c2e1":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a4c4e0e3250340758b0a336e8fbc5025":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"de934db9af534044a23a64cf2de29b68":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"4290061671244e4db7e351a206d68c62":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"feb8fe422d644c00b86c6a80ca173bdf":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"c0545689361746d1b688af6f069abc82":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_d92981884923483d9ec9fef8cafdd2e0","IPY_MODEL_e0e736ed624a4b13bba8eb82c1a30ef2","IPY_MODEL_88d2bb00b59c4d29a1d17777d4d6128b"],"layout":"IPY_MODEL_d1053895d40c4e04b045c5c468182a76"}},"d92981884923483d9ec9fef8cafdd2e0":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_04106f25c52c4498bbbe5ae6cbfe22f5","placeholder":"​","style":"IPY_MODEL_4aa31c0903474640858a5e9366aa1550","value":"Epoch  4: 100%"}},"e0e736ed624a4b13bba8eb82c1a30ef2":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_79ad6eb1f9d14052bc0cbd0537b93ad5","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_04ccde2b6bef456892ca992d9de2d625","value":1841}},"88d2bb00b59c4d29a1d17777d4d6128b":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8e5f972a847f402d8ad77251e2b8554b","placeholder":"​","style":"IPY_MODEL_840f88318bdf4047a6b6924655eb22cf","value":" 1841/1841 [10:22&lt;00:00,  2.96it/s, Loss 1.1536]"}},"d1053895d40c4e04b045c5c468182a76":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"04106f25c52c4498bbbe5ae6cbfe22f5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4aa31c0903474640858a5e9366aa1550":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"79ad6eb1f9d14052bc0cbd0537b93ad5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"04ccde2b6bef456892ca992d9de2d625":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"8e5f972a847f402d8ad77251e2b8554b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"840f88318bdf4047a6b6924655eb22cf":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"7c6a9aa8e4d6421fb92f2e46f960c84f":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_28c5ebdd28754fb68f807cf17aa5a8c5","IPY_MODEL_f66c0f0a01b746fd9a3176eddf951062","IPY_MODEL_3f14312730d84e0a9419c550e6f09b3e"],"layout":"IPY_MODEL_45ad1096daff49009a8ce92fe67e1ea5"}},"28c5ebdd28754fb68f807cf17aa5a8c5":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_76dee89581c042819a3755cc7d6ebbd0","placeholder":"​","style":"IPY_MODEL_e16af99076bc4708b9fabb6ee4405709","value":"Epoch  5: 100%"}},"f66c0f0a01b746fd9a3176eddf951062":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_dab92017dda242d8b7d84ebed674f332","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_34d2fe89b43c4e4aabad10f0c486a8f7","value":1841}},"3f14312730d84e0a9419c550e6f09b3e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_afdf36599dd84ed0b94ab4bc5e7d41d5","placeholder":"​","style":"IPY_MODEL_f414b268d1d547c28c616435cede6b88","value":" 1841/1841 [10:22&lt;00:00,  2.98it/s, Loss 0.9228]"}},"45ad1096daff49009a8ce92fe67e1ea5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"76dee89581c042819a3755cc7d6ebbd0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e16af99076bc4708b9fabb6ee4405709":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"dab92017dda242d8b7d84ebed674f332":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"34d2fe89b43c4e4aabad10f0c486a8f7":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"afdf36599dd84ed0b94ab4bc5e7d41d5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f414b268d1d547c28c616435cede6b88":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"1d5816e45e584eac893d80084bf4316d":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_f2bec4490d9f46af8d67dac1d12bec8a","IPY_MODEL_4117acd7a8004d24930072b34c9ebcfa","IPY_MODEL_e200a4b3987647c095eecc54918adf01"],"layout":"IPY_MODEL_ead0f534880d41479e1c17bf1f0a1c79"}},"f2bec4490d9f46af8d67dac1d12bec8a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e8c2af8cec744932b7b75242e071a33e","placeholder":"​","style":"IPY_MODEL_219e477c7ff04da695189996d770b5c4","value":"Epoch  6: 100%"}},"4117acd7a8004d24930072b34c9ebcfa":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_3cb79e55755d437084371f5212752972","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_1183b4b579964b969312f44f69e17bd9","value":1841}},"e200a4b3987647c095eecc54918adf01":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_634ac1d632e54ec594e7f7911481dc7b","placeholder":"​","style":"IPY_MODEL_a09280bb654e420ab894a9ffbc07cac7","value":" 1841/1841 [10:25&lt;00:00,  2.91it/s, Loss 0.7623]"}},"ead0f534880d41479e1c17bf1f0a1c79":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e8c2af8cec744932b7b75242e071a33e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"219e477c7ff04da695189996d770b5c4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"3cb79e55755d437084371f5212752972":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1183b4b579964b969312f44f69e17bd9":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"634ac1d632e54ec594e7f7911481dc7b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a09280bb654e420ab894a9ffbc07cac7":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"b1fd09e7b97c4ba6904fdac84b13f905":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_144ed7b7b1b341cbadcecc682b69ac1d","IPY_MODEL_90c1dbf3e12c414895ead9fd5b3cca49","IPY_MODEL_6e1b12861e274e68b5d6d4ea178b5e8e"],"layout":"IPY_MODEL_2bd1a6aa308a408a888f82ac6c25c2c3"}},"144ed7b7b1b341cbadcecc682b69ac1d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_35e6ea893fc94b43b7317f33240b715f","placeholder":"​","style":"IPY_MODEL_daaaed6a21f7452baaa8a63a2d93f7f3","value":"Epoch  7: 100%"}},"90c1dbf3e12c414895ead9fd5b3cca49":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_bc4e8f0c733646e58328581e6a6e728f","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b49335cc97cd40efbdcc40720e61ffaa","value":1841}},"6e1b12861e274e68b5d6d4ea178b5e8e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_937ba86b08594b0ab36070f07184c398","placeholder":"​","style":"IPY_MODEL_710b242d215e4a968dee8aa339b2e531","value":" 1841/1841 [10:27&lt;00:00,  2.95it/s, Loss 0.6391]"}},"2bd1a6aa308a408a888f82ac6c25c2c3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"35e6ea893fc94b43b7317f33240b715f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"daaaed6a21f7452baaa8a63a2d93f7f3":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"bc4e8f0c733646e58328581e6a6e728f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b49335cc97cd40efbdcc40720e61ffaa":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"937ba86b08594b0ab36070f07184c398":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"710b242d215e4a968dee8aa339b2e531":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"1a2086501916498c8c15f2d052b430cf":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_35f42414c4be453e9f04c0671de997b5","IPY_MODEL_bffa4337eb6d42dc857b52a41eb1cdd6","IPY_MODEL_b7ab00250e9644beb971eecec5c12c1f"],"layout":"IPY_MODEL_9e3c6c4f8a1c48278cb62a8b347f3456"}},"35f42414c4be453e9f04c0671de997b5":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_2a951e2c19974f568fba07736e54d07f","placeholder":"​","style":"IPY_MODEL_c47fe3301a6b49b5a59ae5f1b4dbcf9d","value":"Epoch  8: 100%"}},"bffa4337eb6d42dc857b52a41eb1cdd6":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_f83634b068f64afd8e7c5401f085b103","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b059711b9728406bbb69ebc3c77e8015","value":1841}},"b7ab00250e9644beb971eecec5c12c1f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_5e70a34d9aaa4ac0a56579e1e99d1472","placeholder":"​","style":"IPY_MODEL_845fd5652a43476bb789bc15d7f7a963","value":" 1841/1841 [10:26&lt;00:00,  2.96it/s, Loss 0.5456]"}},"9e3c6c4f8a1c48278cb62a8b347f3456":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2a951e2c19974f568fba07736e54d07f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c47fe3301a6b49b5a59ae5f1b4dbcf9d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f83634b068f64afd8e7c5401f085b103":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b059711b9728406bbb69ebc3c77e8015":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5e70a34d9aaa4ac0a56579e1e99d1472":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"845fd5652a43476bb789bc15d7f7a963":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cdf6d6aee45741ba9fae4983149778c8":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_21b4fa644b2944838756e77c21d34bc9","IPY_MODEL_58f46ab76bba457e98b7267252d85f8a","IPY_MODEL_babbe3f5111449f89b2930557d2dacff"],"layout":"IPY_MODEL_1ab75d14d8cf4c1baedc4c1ce40d470f"}},"21b4fa644b2944838756e77c21d34bc9":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_4ef5c339cb974e498127e549587dc6a7","placeholder":"​","style":"IPY_MODEL_f2b67fd9c545438bba8e9f12843f8156","value":"Epoch  9: 100%"}},"58f46ab76bba457e98b7267252d85f8a":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_87ffda293695482983f522bb8fc7f714","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_6dc8c15fc4d5423ebec6fa0ae6c040d8","value":1841}},"babbe3f5111449f89b2930557d2dacff":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_cca03c4b34274b318dae9851d2d125ee","placeholder":"​","style":"IPY_MODEL_d997cbf8f251408397bf8418bf637818","value":" 1841/1841 [10:26&lt;00:00,  2.93it/s, Loss 0.4738]"}},"1ab75d14d8cf4c1baedc4c1ce40d470f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4ef5c339cb974e498127e549587dc6a7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f2b67fd9c545438bba8e9f12843f8156":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"87ffda293695482983f522bb8fc7f714":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6dc8c15fc4d5423ebec6fa0ae6c040d8":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"cca03c4b34274b318dae9851d2d125ee":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d997cbf8f251408397bf8418bf637818":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"6fb9106ff929471aa37de67be3c075c6":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_13042221776f430eb60c1d49a51a492f","IPY_MODEL_f295f2e8f75f46bc8c53041b634b074f","IPY_MODEL_53b8b7a9b17449359dd1115619a91528"],"layout":"IPY_MODEL_f656f5429de84e6e931d5722bd59e4e0"}},"13042221776f430eb60c1d49a51a492f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6e0fdc687e70486aa055d090a32cb532","placeholder":"​","style":"IPY_MODEL_45d19e55c3c24d8db0e9219b9c840f8e","value":"Epoch 10: 100%"}},"f295f2e8f75f46bc8c53041b634b074f":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_4f6b7e423b7847239fb12d3404a7e0f3","max":1841,"min":0,"orientation":"horizontal","style":"IPY_MODEL_681918f95b184797b17d0d7dd93ec2e0","value":1841}},"53b8b7a9b17449359dd1115619a91528":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d7e7af1f69944a258c1b4b9f00cb2549","placeholder":"​","style":"IPY_MODEL_800e6f39a3e14624a53963e36a7bd480","value":" 1841/1841 [10:26&lt;00:00,  2.93it/s, Loss 0.4194]"}},"f656f5429de84e6e931d5722bd59e4e0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6e0fdc687e70486aa055d090a32cb532":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"45d19e55c3c24d8db0e9219b9c840f8e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4f6b7e423b7847239fb12d3404a7e0f3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"681918f95b184797b17d0d7dd93ec2e0":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"d7e7af1f69944a258c1b4b9f00cb2549":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"800e6f39a3e14624a53963e36a7bd480":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ee21c77480ce4147bb24861f81940295":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_25df50d65d3447639397b10d2093bbbd","IPY_MODEL_44f02039a2074432a16ad161494e5b49","IPY_MODEL_d6fd4e1cd335428383b91c47c2a596c3"],"layout":"IPY_MODEL_81f51765100849a39b9e4079a11254ae"}},"25df50d65d3447639397b10d2093bbbd":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_fe06870ebef946409b0ad8813084a33d","placeholder":"​","style":"IPY_MODEL_313da4a60155495db0e4cb0df656c6f5","value":"100%"}},"44f02039a2074432a16ad161494e5b49":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_615199aa02874734a15beef02a790f25","max":119,"min":0,"orientation":"horizontal","style":"IPY_MODEL_dcd9b0abf91d415aa4d2421c7747f078","value":119}},"d6fd4e1cd335428383b91c47c2a596c3":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0008a727199b4e69a9d1e1d987935e23","placeholder":"​","style":"IPY_MODEL_a7715cc2ac6440078ed05d36fd316483","value":" 119/119 [10:58&lt;00:00,  5.39s/it]"}},"81f51765100849a39b9e4079a11254ae":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fe06870ebef946409b0ad8813084a33d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"313da4a60155495db0e4cb0df656c6f5":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"615199aa02874734a15beef02a790f25":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"dcd9b0abf91d415aa4d2421c7747f078":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0008a727199b4e69a9d1e1d987935e23":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a7715cc2ac6440078ed05d36fd316483":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5407552467424353983ac3cc51fd985f":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_191a010075384ee383bd3a25f48a1441","IPY_MODEL_655eb8ebcdbb4597ac3103d641557e4b","IPY_MODEL_bdea086e18494fda94494e53c7ef1b94"],"layout":"IPY_MODEL_4d7381fdb414474ca9319a209a0a3422"}},"191a010075384ee383bd3a25f48a1441":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b83425ba162744b2a1d6a649e6631618","placeholder":"​","style":"IPY_MODEL_a8f945bb5f374fb2b649001739a8d603","value":"100%"}},"655eb8ebcdbb4597ac3103d641557e4b":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_325a2d65a99d4d47b10e3f630d2c993e","max":3000,"min":0,"orientation":"horizontal","style":"IPY_MODEL_a6bc8aaec7564ab6bac643e647a1455f","value":3000}},"bdea086e18494fda94494e53c7ef1b94":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e93d01a9c2834a73a4de9ab6d08b706b","placeholder":"​","style":"IPY_MODEL_e9937f59a4be49f3b43c6becbad12e7a","value":" 3000/3000 [02:59&lt;00:00, 17.69it/s]"}},"4d7381fdb414474ca9319a209a0a3422":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b83425ba162744b2a1d6a649e6631618":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a8f945bb5f374fb2b649001739a8d603":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"325a2d65a99d4d47b10e3f630d2c993e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a6bc8aaec7564ab6bac643e647a1455f":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e93d01a9c2834a73a4de9ab6d08b706b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e9937f59a4be49f3b43c6becbad12e7a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"markdown","source":["# transformer 영어-스페인 번역기"],"metadata":{"id":"nGEvt-31zNyy"}},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"B_KywtmdwDa-","executionInfo":{"status":"ok","timestamp":1648783229752,"user_tz":-540,"elapsed":7961,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"da85ebc8-c69c-4ed9-bd11-5340f063714b"},"outputs":[{"output_type":"stream","name":"stdout","text":["2.8.0\n"]}],"source":["import numpy as np\n","import pandas as pd\n","import tensorflow as tf\n","\n","import re\n","import os\n","import io\n","import time\n","import random\n","\n","import seaborn # Attention 시각화를 위해 불러오자~~~!\n","from sklearn.model_selection import train_test_split\n","\n","print(tf.__version__)"]},{"cell_type":"markdown","source":["- 텍스트 입력 [ batch_size x length ] 형태\n","- 번역기 끝난 후에 최종 출력 데이터 : [ batch_size x length x vocab_size ] 형태"],"metadata":{"id":"kqRfYfn_3WGr"}},{"cell_type":"markdown","source":["번역 문제는 매 스텝마다 vocab_size만큼의 클래스 갯수 중 적당한 단어를 선택하는 작업을 length만큼 반복하는 것!!"],"metadata":{"id":"bfbq9pP13v9f"}},{"cell_type":"code","source":["path_to_zip = tf.keras.utils.get_file(\n","    'spa-eng.zip',\n","    origin = 'http://storage.googleapis.com/download.tensorflow.org/data/spa-eng.zip',\n","    extract=True\n",")\n","\n","path_to_file = os.path.dirname(path_to_zip) + \"/spa-eng/spa.txt\"\n","\n","with open(path_to_file, \"r\") as f:\n","    corpus = f.read().splitlines()\n","\n","print(\"Data Size : \", len(corpus))\n","print(\"Example\")\n","for sen in corpus[0:100][::20]: print(\">>\", sen)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"_sJLmkHr2z4a","executionInfo":{"status":"ok","timestamp":1648783230156,"user_tz":-540,"elapsed":409,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"b1dd2497-8492-4194-aa67-1a5c88a07998"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Downloading data from http://storage.googleapis.com/download.tensorflow.org/data/spa-eng.zip\n","2646016/2638744 [==============================] - 0s 0us/step\n","2654208/2638744 [==============================] - 0s 0us/step\n","Data Size :  118964\n","Example\n",">> Go.\tVe.\n",">> Wait.\tEsperen.\n",">> Hug me.\tAbrázame.\n",">> No way!\t¡Ni cagando!\n",">> Call me.\tLlamame.\n"]}]},{"cell_type":"markdown","source":["## 토큰화"],"metadata":{"id":"1LZOBqnh7Mf0"}},{"cell_type":"code","source":["!pip install sentencepiece"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"TlwLX7yx7YJt","executionInfo":{"status":"ok","timestamp":1648783241625,"user_tz":-540,"elapsed":11471,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"56c0a072-a056-4dbc-f34d-14aa79843290"},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting sentencepiece\n","  Downloading sentencepiece-0.1.96-cp37-cp37m-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.2 MB)\n","\u001b[?25l\r\u001b[K     |▎                               | 10 kB 20.5 MB/s eta 0:00:01\r\u001b[K     |▌                               | 20 kB 11.8 MB/s eta 0:00:01\r\u001b[K     |▉                               | 30 kB 8.6 MB/s eta 0:00:01\r\u001b[K     |█                               | 40 kB 7.7 MB/s eta 0:00:01\r\u001b[K     |█▍                              | 51 kB 4.4 MB/s eta 0:00:01\r\u001b[K     |█▋                              | 61 kB 4.5 MB/s eta 0:00:01\r\u001b[K     |██                              | 71 kB 5.1 MB/s eta 0:00:01\r\u001b[K     |██▏                             | 81 kB 4.4 MB/s eta 0:00:01\r\u001b[K     |██▍                             | 92 kB 4.9 MB/s eta 0:00:01\r\u001b[K     |██▊                             | 102 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███                             | 112 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███▎                            | 122 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███▌                            | 133 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███▉                            | 143 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████                            | 153 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████▎                           | 163 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████▋                           | 174 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████▉                           | 184 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████▏                          | 194 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████▍                          | 204 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████▊                          | 215 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████                          | 225 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████▏                         | 235 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████▌                         | 245 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████▊                         | 256 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████                         | 266 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████▎                        | 276 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████▋                        | 286 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████▉                        | 296 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████                        | 307 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████▍                       | 317 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████▋                       | 327 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████                       | 337 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████▏                      | 348 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████▌                      | 358 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████▊                      | 368 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████                      | 378 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████▎                     | 389 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████▌                     | 399 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████▉                     | 409 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████                     | 419 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████▍                    | 430 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████▋                    | 440 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████▉                    | 450 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████▏                   | 460 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████▍                   | 471 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████▊                   | 481 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████                   | 491 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████▎                  | 501 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████▌                  | 512 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████▊                  | 522 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████                  | 532 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████▎                 | 542 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████▋                 | 552 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████▉                 | 563 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████▏                | 573 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████▍                | 583 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████▋                | 593 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████                | 604 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████▏               | 614 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████▌               | 624 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████▊               | 634 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████               | 645 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████▎              | 655 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████▌              | 665 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████▉              | 675 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████              | 686 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████▍             | 696 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████▋             | 706 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████             | 716 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████▏            | 727 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████▍            | 737 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████▊            | 747 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████            | 757 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████▎           | 768 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████▌           | 778 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████▉           | 788 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████           | 798 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████▎          | 808 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████▋          | 819 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████▉          | 829 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▏         | 839 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▍         | 849 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▊         | 860 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████         | 870 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████▏        | 880 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████▌        | 890 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████▊        | 901 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████        | 911 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████▎       | 921 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████▋       | 931 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████▉       | 942 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████       | 952 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▍      | 962 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▋      | 972 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████      | 983 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▏     | 993 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▌     | 1.0 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▊     | 1.0 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████     | 1.0 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▎    | 1.0 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▌    | 1.0 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▉    | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████    | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▍   | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▋   | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▉   | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▏  | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▍  | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▊  | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████  | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▎ | 1.1 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▌ | 1.2 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▊ | 1.2 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████ | 1.2 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▎| 1.2 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▋| 1.2 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▉| 1.2 MB 5.3 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 1.2 MB 5.3 MB/s \n","\u001b[?25hInstalling collected packages: sentencepiece\n","Successfully installed sentencepiece-0.1.96\n"]}]},{"cell_type":"code","source":["def generate_tokenizer(corpus,\n","                       vocab_size,\n","                       lang = \"spa-eng\", \n","                       pad_id = 0, # pad token의 일련번호\n","                       bos_id = 1, # 문장의 시작을 의미하는 bos\n","                       eos_id = 2, # 문장의 끝을 의미하는 eos\n","                       unk_id = 3): # unk token의 일련번호\n","    file = \"./%s_corpus.txt\" % lang\n","    model = \"%s_spm\" % lang\n","\n","    with open(file, 'w') as f:\n","        for row in corpus: f.write(str(row) + '\\n')\n","    # 코퍼스 만들기\n","\n","    import sentencepiece as spm\n","    spm.SentencePieceTrainer.Train(\n","        '--input=./%s --model_prefix=%s --vocab_size=%d'\\\n","        %(file, model, vocab_size) + \\\n","        '--pad_id=%d --bos_id=%d --eos_id=%d --unk_id=%d'\\\n","        % (pad_id, bos_id, eos_id, unk_id)\n","    )\n","\n","    tokenizer = spm.SentencePieceProcessor()\n","    tokenizer.Load('%s.model' % model)\n","    return tokenizer"],"metadata":{"id":"Tp0EAbKs6WM_","executionInfo":{"status":"ok","timestamp":1648783241626,"user_tz":-540,"elapsed":4,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":4,"outputs":[]},{"cell_type":"code","source":["cleaned_corpus = list(set(corpus))\n","\n","vocab_size = 20000\n","tokenizer = generate_tokenizer(cleaned_corpus, vocab_size)\n","tokenizer.set_encode_extra_options(\"bos:eos\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"PT2IdgY184dz","executionInfo":{"status":"ok","timestamp":1648783255729,"user_tz":-540,"elapsed":14106,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"fc6c281e-c919-4c16-a931-c5f51d5649db"},"execution_count":5,"outputs":[{"output_type":"execute_result","data":{"text/plain":["True"]},"metadata":{},"execution_count":5}]},{"cell_type":"markdown","source":["## 정제\n","정제된 데이터가 50개 이상의 토큰을 갖는 경우는 제거!"],"metadata":{"id":"cAAv7y_h-D9I"}},{"cell_type":"code","source":["def preprocess_sentence(sentence):\n","    sentence = sentence.lower()\n","\n","    sentence = re.sub(r\"([?.!,¿¡])\", r\" \\1 \", sentence)\n","    sentence = re.sub(r'[\" \"]+', \" \", sentence)\n","    sentence = re.sub(r\"[^a-zA-Z?.!,¿¡]+\", \" \", sentence)\n","\n","    sentence = sentence.strip()\n","\n","    return sentence"],"metadata":{"id":"ZdWPGp-b9ns8","executionInfo":{"status":"ok","timestamp":1648783255729,"user_tz":-540,"elapsed":5,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":6,"outputs":[]},{"cell_type":"code","source":["from tqdm import tqdm_notebook\n","\n","src_corpus = []\n","tgt_corpus = []\n","\n","for pair in tqdm_notebook(cleaned_corpus):\n","    src, tgt = pair.split('\\t')\n","    \n","    src_tokens = tokenizer.encode_as_ids(preprocess_sentence(src)) # 문자열 -> 숫자\n","    tgt_tokens = tokenizer.encode_as_ids(preprocess_sentence(tgt))\n","\n","    # 정제된 데이터가 50개 이상의 토큰을 갖는 경우는 제거!\n","    if (len(src_tokens) > 50): continue\n","    if (len(tgt_tokens) > 50): continue\n","\n","    src_corpus.append(src_tokens)\n","    tgt_corpus.append(tgt_tokens)\n","\n","len(src_corpus)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":124,"referenced_widgets":["df845705580c4ca397c0e6b15c4ede17","75f401ec998d425e93fbd8a2f6473d4d","f6d772632cc44df0a682a3b8c2261c1d","4345b9211b544f74a10a1b44c8b28575","3f59d39dd8464c6d892f27960913caaa","e1bdfc7d4a384f2c9199300fcac4de77","001d98363a8b4e23b73a4438935331d4","46121501ce734d4cbf8d445677ae4bdc","d1d9f4ee11ef41d097fab56d12c4a448","0712fd1cb1394dcc9a6880ccc2ed8101","9ed15da4adf948fc877a0fb01b8dd52c"]},"id":"y7dkBtIW-p_s","executionInfo":{"status":"ok","timestamp":1648783273045,"user_tz":-540,"elapsed":17321,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"520acce0-db43-4e35-dd86-badef8507c4b"},"execution_count":7,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:6: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  \n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/118964 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"df845705580c4ca397c0e6b15c4ede17"}},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":["118951"]},"metadata":{},"execution_count":7}]},{"cell_type":"code","source":["enc_tensor = tf.keras.preprocessing.sequence.pad_sequences(src_corpus, padding='post')\n","dec_tensor = tf.keras.preprocessing.sequence.pad_sequences(tgt_corpus, padding='post')\n","\n","enc_train, enc_val, dec_train, dec_val = \\\n","train_test_split(enc_tensor, dec_tensor, test_size= 0.01)\n","\n","print(\"enc_train :\", len(enc_train), \"enc_val :\", len(enc_val))\n","print(\"dec_train :\", len(dec_train), \"dec_val :\", len(dec_val))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"6A8N__XD_urb","executionInfo":{"status":"ok","timestamp":1648783275981,"user_tz":-540,"elapsed":2938,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"b154c8b0-8207-4784-d551-6579b7ee74dc"},"execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["enc_train : 117761 enc_val : 1190\n","dec_train : 117761 dec_val : 1190\n"]}]},{"cell_type":"markdown","source":["## 모델 설계 : transformer"],"metadata":{"id":"ktIlIfcGBECS"}},{"cell_type":"markdown","source":["1. 입력데이터 **[ batch_size x length ]**\n","2. Source & Target Embeding **[ batch_size x length x d_emb ]**\n","3. Positional Encoding\n","4. Multi-Head Attention\n","    - Split Heads **[ batch_size x length x heads x (d_emb / n_heads)]**\n","    - Masking for Masked Attention\n","    - Scaled Dot Product Attention\n","    - Combine Heads **[ batch_size x length x d_emb ]**\n","5. Residual Connection\n","6. Layer normalization\n","7. Position-wise Feed Forward Netword **[batch_size x length x d_ff ]**\n","8. Ouput Linear Layer **[batch_size x length x vocba_size]**"],"metadata":{"id":"NILF3MDz4Lut"}},{"cell_type":"markdown","source":["### Positional Encoding 구현"],"metadata":{"id":"_8BVn3PdF9q_"}},{"cell_type":"code","source":["# Positional Encoding 구현\n","def positional_encoding(pos, d_model):\n","    def cal_angle(position, i):\n","        return position / np.power(10000, int(i) / d_model)\n","\n","    def get_posi_angle_vec(position):\n","        return [cal_angle(position, i) for i in range(d_model)]\n","\n","    sinusoid_table = np.array([get_posi_angle_vec(pos_i) for pos_i in range(pos)])\n","\n","    sinusoid_table[:, 0::2] = np.sin(sinusoid_table[:, 0::2])\n","    sinusoid_table[:, 1::2] = np.cos(sinusoid_table[:, 1::2])\n","\n","    return sinusoid_table"],"metadata":{"id":"hqIPhea7A8A6","executionInfo":{"status":"ok","timestamp":1648783275981,"user_tz":-540,"elapsed":2,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":9,"outputs":[]},{"cell_type":"markdown","source":["### 마스크 생성"],"metadata":{"id":"-5PSUFU5GNXS"}},{"cell_type":"code","source":["# Mask  생성하기\n","def generate_padding_mask(seq):\n","    seq = tf.cast(tf.math.equal(seq, 0), tf.float32)\n","    return seq[:, tf.newaxis, tf.newaxis, :]\n","\n","def generate_causality_mask(src_len, tgt_len):\n","    mask = 1 - np.cumsum(np.eye(src_len, tgt_len), 0)\n","    return tf.cast(mask, tf.float32)\n","\n","def generate_masks(src, tgt):\n","    enc_mask = generate_padding_mask(src)\n","    dec_mask = generate_padding_mask(tgt)\n","\n","    dec_causality_mask = generate_causality_mask(tgt.shape[1], tgt.shape[1])\n","    dec_mask = tf.maximum(dec_mask, dec_causality_mask)\n","\n","    dec_enc_causality_mask = generate_causality_mask(tgt.shape[1], src.shape[1])\n","    dec_enc_mask = tf.maximum(enc_mask, dec_enc_causality_mask)\n","\n","    return enc_mask, dec_enc_mask, dec_mask"],"metadata":{"id":"H_qmBlg1GGkw","executionInfo":{"status":"ok","timestamp":1648783275982,"user_tz":-540,"elapsed":2,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":10,"outputs":[]},{"cell_type":"markdown","source":["### Multi-Head Attention"],"metadata":{"id":"lj8jPze4GSdW"}},{"cell_type":"code","source":["class MultiHeadAttention(tf.keras.layers.Layer):\n","    def __init__(self, d_model, num_heads):\n","        super(MultiHeadAttention, self).__init__()\n","        self.num_heads = num_heads\n","        self.d_model = d_model\n","\n","        self.depth = d_model // self.num_heads\n","\n","        self.W_q = tf.keras.layers.Dense(d_model)\n","        self.W_k = tf.keras.layers.Dense(d_model)\n","        self.W_v = tf.keras.layers.Dense(d_model)\n","\n","        self.linear = tf.keras.layers.Dense(d_model)\n","\n","    def scaled_dot_product_attention(self, Q, K, V, mask):\n","        d_k = tf.cast(K.shape[-1], tf.float32)\n","        QK = tf.matmul(Q, K, transpose_b=True)\n","\n","        scaled_qk = QK / tf.math.sqrt(d_k)\n","\n","        if mask is not None: scaled_qk += (mask * -1e9)  \n","\n","        attentions = tf.nn.softmax(scaled_qk, axis=-1)\n","        out = tf.matmul(attentions, V)\n","\n","        return out, attentions\n","\n","\n","    def split_heads(self, x):\n","        bsz = x.shape[0]\n","        split_x = tf.reshape(x, (bsz, -1, self.num_heads, self.depth))\n","        split_x = tf.transpose(split_x, perm=[0, 2, 1, 3])\n","\n","        return split_x\n","\n","    def combine_heads(self, x):\n","        bsz = x.shape[0]\n","        combined_x = tf.transpose(x, perm=[0, 2, 1, 3])\n","        combined_x = tf.reshape(combined_x, (bsz, -1, self.d_model))\n","\n","        return combined_x\n","\n","\n","    def call(self, Q, K, V, mask):\n","        WQ = self.W_q(Q)\n","        WK = self.W_k(K)\n","        WV = self.W_v(V)\n","\n","        WQ_splits = self.split_heads(WQ)\n","        WK_splits = self.split_heads(WK)\n","        WV_splits = self.split_heads(WV)\n","\n","        out, attention_weights = self.scaled_dot_product_attention(\n","            WQ_splits, WK_splits, WV_splits, mask)\n","\n","        out = self.combine_heads(out)\n","        out = self.linear(out)\n","\n","        return out, attention_weights"],"metadata":{"id":"lcu6cikrGP3F","executionInfo":{"status":"ok","timestamp":1648783276349,"user_tz":-540,"elapsed":369,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":11,"outputs":[]},{"cell_type":"markdown","source":["### Position-wise Feed Forward Network"],"metadata":{"id":"B2K7GMjsGe5D"}},{"cell_type":"code","source":["class PoswiseFeedForwardNet(tf.keras.layers.Layer):\n","    def __init__(self, d_model, d_ff):\n","        super(PoswiseFeedForwardNet, self).__init__()\n","        self.d_model = d_model\n","        self.d_ff = d_ff\n","\n","        self.fc1 = tf.keras.layers.Dense(d_ff, activation='relu')\n","        self.fc2 = tf.keras.layers.Dense(d_model)\n","\n","    def call(self, x):\n","        out = self.fc1(x)\n","        out = self.fc2(out)\n","\n","        return out"],"metadata":{"id":"sHe94W1DGVoD","executionInfo":{"status":"ok","timestamp":1648783276349,"user_tz":-540,"elapsed":3,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":12,"outputs":[]},{"cell_type":"markdown","source":["### Encoder Layer"],"metadata":{"id":"UUdZr7nJGrpd"}},{"cell_type":"code","source":["class EncoderLayer(tf.keras.layers.Layer):\n","    def __init__(self, d_model, n_heads, d_ff, dropout):\n","        super(EncoderLayer, self).__init__()\n","\n","        self.enc_self_attn = MultiHeadAttention(d_model, n_heads)\n","        self.ffn = PoswiseFeedForwardNet(d_model, d_ff)\n","\n","        self.norm_1 = tf.keras.layers.LayerNormalization(epsilon=1e-6)\n","        self.norm_2 = tf.keras.layers.LayerNormalization(epsilon=1e-6)\n","\n","        self.do = tf.keras.layers.Dropout(dropout)\n","\n","    def call(self, x, mask):\n","\n","        \"\"\"\n","        Multi-Head Attention\n","        \"\"\"\n","        residual = x\n","        out = self.norm_1(x)\n","        out, enc_attn = self.enc_self_attn(out, out, out, mask)\n","        out = self.do(out)\n","        out += residual\n","\n","        \"\"\"\n","        Position-Wise Feed Forward Network\n","        \"\"\"\n","        residual = out\n","        out = self.norm_2(out)\n","        out = self.ffn(out)\n","        out = self.do(out)\n","        out += residual\n","\n","        return out, enc_attn"],"metadata":{"id":"kcfaLs3sGsy9","executionInfo":{"status":"ok","timestamp":1648783276350,"user_tz":-540,"elapsed":3,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":13,"outputs":[]},{"cell_type":"markdown","source":["### Decoder layer"],"metadata":{"id":"4KiskVgaGyeD"}},{"cell_type":"code","source":["class DecoderLayer(tf.keras.layers.Layer):\n","    def __init__(self, d_model, num_heads, d_ff, dropout):\n","        super(DecoderLayer, self).__init__()\n","\n","        self.dec_self_attn = MultiHeadAttention(d_model, num_heads)\n","        self.enc_dec_attn = MultiHeadAttention(d_model, num_heads)\n","\n","        self.ffn = PoswiseFeedForwardNet(d_model, d_ff)\n","\n","        self.norm_1 = tf.keras.layers.LayerNormalization(epsilon=1e-6)\n","        self.norm_2 = tf.keras.layers.LayerNormalization(epsilon=1e-6)\n","        self.norm_3 = tf.keras.layers.LayerNormalization(epsilon=1e-6)\n","\n","        self.do = tf.keras.layers.Dropout(dropout)\n","\n","    def call(self, x, enc_out, causality_mask, padding_mask):\n","\n","        \"\"\"\n","        Masked Multi-Head Attention\n","        \"\"\"\n","        residual = x\n","        out = self.norm_1(x)\n","        out, dec_attn = self.dec_self_attn(out, out, out, padding_mask)\n","        out = self.do(out)\n","        out += residual\n","\n","        \"\"\"\n","        Multi-Head Attention\n","        \"\"\"\n","        residual = out\n","        out = self.norm_2(out)\n","        out, dec_enc_attn = self.dec_self_attn(out, enc_out, enc_out, causality_mask)\n","        out = self.do(out)\n","        out += residual\n","\n","        \"\"\"\n","        Position-Wise Feed Forward Network\n","        \"\"\"\n","        residual = out\n","        out = self.norm_3(out)\n","        out = self.ffn(out)\n","        out = self.do(out)\n","        out += residual\n","\n","        return out, dec_attn, dec_enc_attn"],"metadata":{"id":"NIbQsYRjGuTX","executionInfo":{"status":"ok","timestamp":1648783276350,"user_tz":-540,"elapsed":3,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":14,"outputs":[]},{"cell_type":"markdown","source":["### Encoder Stack"],"metadata":{"id":"owQzWEHbG9sN"}},{"cell_type":"code","source":["class Encoder(tf.keras.Model):\n","    def __init__(self,\n","                    n_layers,\n","                    d_model,\n","                    n_heads,\n","                    d_ff,\n","                    dropout):\n","        super(Encoder, self).__init__()\n","        self.n_layers = n_layers\n","        self.enc_layers = [EncoderLayer(d_model, n_heads, d_ff, dropout) \n","                        for _ in range(n_layers)]\n","\n","        self.do = tf.keras.layers.Dropout(dropout)\n","\n","    def call(self, x, mask):\n","        out = x\n","\n","        enc_attns = list()\n","        for i in range(self.n_layers):\n","            out, enc_attn = self.enc_layers[i](out, mask)\n","            enc_attns.append(enc_attn)\n","\n","        return out, enc_attns"],"metadata":{"id":"9NVVTwPOG1ro","executionInfo":{"status":"ok","timestamp":1648783276350,"user_tz":-540,"elapsed":3,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":15,"outputs":[]},{"cell_type":"markdown","source":["### Decoder Stack"],"metadata":{"id":"8I3XrGNyHBXq"}},{"cell_type":"code","source":["class Decoder(tf.keras.Model):\n","    def __init__(self,\n","                    n_layers,\n","                    d_model,\n","                    n_heads,\n","                    d_ff,\n","                    dropout):\n","        super(Decoder, self).__init__()\n","        self.n_layers = n_layers\n","        self.dec_layers = [DecoderLayer(d_model, n_heads, d_ff, dropout) \n","                            for _ in range(n_layers)]\n","\n","\n","    def call(self, x, enc_out, causality_mask, padding_mask):\n","        out = x\n","\n","        dec_attns = list()\n","        dec_enc_attns = list()\n","        for i in range(self.n_layers):\n","            out, dec_attn, dec_enc_attn = \\\n","            self.dec_layers[i](out, enc_out, causality_mask, padding_mask)\n","\n","            dec_attns.append(dec_attn)\n","            dec_enc_attns.append(dec_enc_attn)\n","\n","        return out, dec_attns, dec_enc_attns"],"metadata":{"id":"XDA992PJHAeE","executionInfo":{"status":"ok","timestamp":1648783276350,"user_tz":-540,"elapsed":3,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":16,"outputs":[]},{"cell_type":"markdown","source":["### Transformer 전체 모델 조립"],"metadata":{"id":"ocwY-kavHFwL"}},{"cell_type":"code","source":["class Transformer(tf.keras.Model):\n","    def __init__(self,\n","                    n_layers,\n","                    d_model,\n","                    n_heads,\n","                    d_ff,\n","                    src_vocab_size,\n","                    tgt_vocab_size,\n","                    pos_len,\n","                    dropout=0.2,\n","                    shared_fc=True,\n","                    shared_emb=False):\n","        super(Transformer, self).__init__()\n","\n","        self.d_model = tf.cast(d_model, tf.float32)\n","\n","        if shared_emb:\n","            self.enc_emb = self.dec_emb = \\\n","            tf.keras.layers.Embedding(src_vocab_size, d_model)\n","        else:\n","            self.enc_emb = tf.keras.layers.Embedding(src_vocab_size, d_model)\n","            self.dec_emb = tf.keras.layers.Embedding(tgt_vocab_size, d_model)\n","\n","        self.pos_encoding = positional_encoding(pos_len, d_model)\n","        self.do = tf.keras.layers.Dropout(dropout)\n","\n","        self.encoder = Encoder(n_layers, d_model, n_heads, d_ff, dropout)\n","        self.decoder = Decoder(n_layers, d_model, n_heads, d_ff, dropout)\n","\n","        self.fc = tf.keras.layers.Dense(tgt_vocab_size)\n","\n","        self.shared_fc = shared_fc\n","\n","        if shared_fc:\n","            self.fc.set_weights(tf.transpose(self.dec_emb.weights))\n","\n","    def embedding(self, emb, x):\n","        seq_len = x.shape[1]\n","\n","        out = emb(x)\n","\n","        if self.shared_fc: out *= tf.math.sqrt(self.d_model)\n","\n","        out += self.pos_encoding[np.newaxis, ...][:, :seq_len, :]\n","        out = self.do(out)\n","\n","        return out\n","\n","\n","    def call(self, enc_in, dec_in, enc_mask, causality_mask, dec_mask):\n","        enc_in = self.embedding(self.enc_emb, enc_in)\n","        dec_in = self.embedding(self.dec_emb, dec_in)\n","\n","        enc_out, enc_attns = self.encoder(enc_in, enc_mask)\n","\n","        dec_out, dec_attns, dec_enc_attns = \\\n","        self.decoder(dec_in, enc_out, causality_mask, dec_mask)\n","\n","        logits = self.fc(dec_out)\n","\n","        return logits, enc_attns, dec_attns, dec_enc_attns"],"metadata":{"id":"K2OgDE6UHEJb","executionInfo":{"status":"ok","timestamp":1648783276678,"user_tz":-540,"elapsed":330,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":17,"outputs":[]},{"cell_type":"markdown","source":["## 하이퍼파라미터 (config)"],"metadata":{"id":"Lw7c2ysGHkuO"}},{"cell_type":"code","source":["# 주어진 하이퍼파라미터로 Transformer 인스턴스 생성\n","transformer = Transformer(\n","    n_layers=2,\n","    d_model=512,\n","    n_heads=8,\n","    d_ff=2048,\n","    src_vocab_size=vocab_size,\n","    tgt_vocab_size=vocab_size,\n","    pos_len=200,\n","    dropout=0.3,\n","    shared_fc=True,\n","    shared_emb=True)\n","\n","d_model = 512"],"metadata":{"id":"U0LrPHVcHJvC","executionInfo":{"status":"ok","timestamp":1648783281935,"user_tz":-540,"elapsed":5259,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":18,"outputs":[]},{"cell_type":"markdown","source":["### Learning Rate Scheduler"],"metadata":{"id":"SKd3SW6EH4P-"}},{"cell_type":"code","source":["# Learning Rate Scheduler 구현\n","class LearningRateScheduler(tf.keras.optimizers.schedules.LearningRateSchedule):\n","    def __init__(self, d_model, warmup_steps=4000):\n","        super(LearningRateScheduler, self).__init__()\n","        \n","        self.d_model = d_model\n","        self.warmup_steps = warmup_steps\n","    \n","    def __call__(self, step):\n","        arg1 = step ** -0.5\n","        arg2 = step * (self.warmup_steps ** -1.5)\n","\n","        return (self.d_model ** -0.5) * tf.math.minimum(arg1, arg2)"],"metadata":{"id":"vSFxQSPLHnvL","executionInfo":{"status":"ok","timestamp":1648783281938,"user_tz":-540,"elapsed":8,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":19,"outputs":[]},{"cell_type":"markdown","source":["### Learning Rate & Optimizer"],"metadata":{"id":"4SfHot4RH91V"}},{"cell_type":"code","source":["# Learning Rate 인스턴스 선언 & Optimizer 구현\n","learning_rate = LearningRateScheduler(d_model)\n","\n","optimizer = tf.keras.optimizers.Adam(learning_rate,\n","                                        beta_1=0.9,\n","                                        beta_2=0.98, \n","                                        epsilon=1e-9)"],"metadata":{"id":"MbV9A-HxH7pB","executionInfo":{"status":"ok","timestamp":1648783281939,"user_tz":-540,"elapsed":8,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":20,"outputs":[]},{"cell_type":"markdown","source":["## Loss function 정의"],"metadata":{"id":"VIck0ie1IGxG"}},{"cell_type":"code","source":["loss_object = tf.keras.losses.SparseCategoricalCrossentropy(\n","    from_logits=True, reduction='none')\n","\n","def loss_function(real, pred):\n","    mask = tf.math.logical_not(tf.math.equal(real, 0))\n","    loss_ = loss_object(real, pred)\n","\n","    mask = tf.cast(mask, dtype=loss_.dtype)\n","    loss_ *= mask\n","\n","    return tf.reduce_sum(loss_)/tf.reduce_sum(mask)"],"metadata":{"id":"1HxQy7rnIC8n","executionInfo":{"status":"ok","timestamp":1648783281939,"user_tz":-540,"elapsed":7,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":21,"outputs":[]},{"cell_type":"markdown","source":["## Train Step 정의"],"metadata":{"id":"Bt3EKcnXIMl-"}},{"cell_type":"code","source":["# Train Step정의\n","@tf.function()\n","def train_step(src, tgt, model, optimizer):\n","    tgt_in = tgt[:, :-1] # Decoder의 inpurt\n","    gold = tgt[:, 1:] # Decoder의 output과 비교하기 위해 right shift를 통해 생성한 최종 타겟\n","\n","    enc_mask, dec_enc_mask, dec_mask = generate_masks(src, tgt_in)\n","\n","    with tf.GradientTape() as tape:\n","        predictions, enc_attns, dec_attns, dec_enc_attns = \\\n","        model(src, tgt_in, enc_mask, dec_enc_mask, dec_mask)\n","        loss = loss_function(gold, predictions)\n","    \n","    gradients = tape.gradient(loss, model.trainable_variables)\n","    optimizer.apply_gradients(zip(gradients, model.trainable_variables))\n","\n","    return loss, enc_attns, dec_attns, dec_enc_attns"],"metadata":{"id":"ZuPM1VEWIKec","executionInfo":{"status":"ok","timestamp":1648783281939,"user_tz":-540,"elapsed":7,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":22,"outputs":[]},{"cell_type":"markdown","source":["## 훈련시키기"],"metadata":{"id":"-Y7GrAoBItFt"}},{"cell_type":"code","source":["from tqdm import tqdm_notebook\n","\n","batch_size = 64\n","epochs = 10\n","\n","for epoch in range(epochs):\n","    total_loss = 0\n","\n","    idx_list = list(range(0, enc_train.shape[0], batch_size))\n","    random.shuffle(idx_list)\n","    t = tqdm_notebook(idx_list)\n","\n","    for (batch, idx) in enumerate(t):\n","        batch_loss, enc_attns, dec_attns, dec_enc_attns = \\\n","        train_step(enc_train[idx:idx+batch_size],\n","                   dec_train[idx:idx+batch_size],\n","                   transformer,\n","                   optimizer)\n","        \n","        total_loss += batch_loss\n","\n","        t.set_description_str('Epoch %2d' % (epoch + 1))\n","        t.set_postfix_str('Loss %.4f' % (total_loss.numpy() / (batch + 1)))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":393,"referenced_widgets":["916e070fe0ed47f2a2a694c32a7d5b38","303daa8d589f445aab2658bd1d47af2b","0aff4e9c561a465fa71686a35fd577af","85632387f7b041548f91e6994f37775d","6e820d5cfd1c43349ac6e8c7b1d9a641","214c084865c74503aabcd3b415a39d99","92560677e502423a83f97f3f01142cbe","f5bab3ea55a5468eaa0fc31a8d117f7e","5a7f9e5bfe0f4fc1a4d264cf78c05275","1f03d0f898bf494ba20067dc2a870651","8435a250fc854d8d8b118b47370942d1","52d7ce9b0de44774b5faf57c5d6963db","8a78b9f58da1407ab9bfe1949e160698","4ae6caded9a04560b32439b1633fd74f","d0164f64c59342ef8c9b732c06a912ff","32f704952e364e7b9175cee4a8c44e55","0b6b7dea29db403e9d9ffb40c33e0238","833c0b499bd34ac097bf2d9ebc86f340","c3add340d0ac430cbb5bae1d07ae2f76","d62be91de4ca40b794084289d4a556db","de3273560d3e452198ffa7b043954184","4644d48349d9475fa3a45f93e5a69acf","f9d479d62a194925a6e5fd0efe4ccf1f","a47ea5036371470688b01909f292f25e","e86edec5d17d4f0899e49809f8fb4552","8abcaa7d448d464bbb3d47d38602007d","2a80abea5e8e48ef8473ef0a758c2e81","7d193223c7a6407e9a116a48802fd7de","2bcc8cb48c1b49a9bfaff3c10c59c2e1","a4c4e0e3250340758b0a336e8fbc5025","de934db9af534044a23a64cf2de29b68","4290061671244e4db7e351a206d68c62","feb8fe422d644c00b86c6a80ca173bdf","c0545689361746d1b688af6f069abc82","d92981884923483d9ec9fef8cafdd2e0","e0e736ed624a4b13bba8eb82c1a30ef2","88d2bb00b59c4d29a1d17777d4d6128b","d1053895d40c4e04b045c5c468182a76","04106f25c52c4498bbbe5ae6cbfe22f5","4aa31c0903474640858a5e9366aa1550","79ad6eb1f9d14052bc0cbd0537b93ad5","04ccde2b6bef456892ca992d9de2d625","8e5f972a847f402d8ad77251e2b8554b","840f88318bdf4047a6b6924655eb22cf","7c6a9aa8e4d6421fb92f2e46f960c84f","28c5ebdd28754fb68f807cf17aa5a8c5","f66c0f0a01b746fd9a3176eddf951062","3f14312730d84e0a9419c550e6f09b3e","45ad1096daff49009a8ce92fe67e1ea5","76dee89581c042819a3755cc7d6ebbd0","e16af99076bc4708b9fabb6ee4405709","dab92017dda242d8b7d84ebed674f332","34d2fe89b43c4e4aabad10f0c486a8f7","afdf36599dd84ed0b94ab4bc5e7d41d5","f414b268d1d547c28c616435cede6b88","1d5816e45e584eac893d80084bf4316d","f2bec4490d9f46af8d67dac1d12bec8a","4117acd7a8004d24930072b34c9ebcfa","e200a4b3987647c095eecc54918adf01","ead0f534880d41479e1c17bf1f0a1c79","e8c2af8cec744932b7b75242e071a33e","219e477c7ff04da695189996d770b5c4","3cb79e55755d437084371f5212752972","1183b4b579964b969312f44f69e17bd9","634ac1d632e54ec594e7f7911481dc7b","a09280bb654e420ab894a9ffbc07cac7","b1fd09e7b97c4ba6904fdac84b13f905","144ed7b7b1b341cbadcecc682b69ac1d","90c1dbf3e12c414895ead9fd5b3cca49","6e1b12861e274e68b5d6d4ea178b5e8e","2bd1a6aa308a408a888f82ac6c25c2c3","35e6ea893fc94b43b7317f33240b715f","daaaed6a21f7452baaa8a63a2d93f7f3","bc4e8f0c733646e58328581e6a6e728f","b49335cc97cd40efbdcc40720e61ffaa","937ba86b08594b0ab36070f07184c398","710b242d215e4a968dee8aa339b2e531","1a2086501916498c8c15f2d052b430cf","35f42414c4be453e9f04c0671de997b5","bffa4337eb6d42dc857b52a41eb1cdd6","b7ab00250e9644beb971eecec5c12c1f","9e3c6c4f8a1c48278cb62a8b347f3456","2a951e2c19974f568fba07736e54d07f","c47fe3301a6b49b5a59ae5f1b4dbcf9d","f83634b068f64afd8e7c5401f085b103","b059711b9728406bbb69ebc3c77e8015","5e70a34d9aaa4ac0a56579e1e99d1472","845fd5652a43476bb789bc15d7f7a963","cdf6d6aee45741ba9fae4983149778c8","21b4fa644b2944838756e77c21d34bc9","58f46ab76bba457e98b7267252d85f8a","babbe3f5111449f89b2930557d2dacff","1ab75d14d8cf4c1baedc4c1ce40d470f","4ef5c339cb974e498127e549587dc6a7","f2b67fd9c545438bba8e9f12843f8156","87ffda293695482983f522bb8fc7f714","6dc8c15fc4d5423ebec6fa0ae6c040d8","cca03c4b34274b318dae9851d2d125ee","d997cbf8f251408397bf8418bf637818","6fb9106ff929471aa37de67be3c075c6","13042221776f430eb60c1d49a51a492f","f295f2e8f75f46bc8c53041b634b074f","53b8b7a9b17449359dd1115619a91528","f656f5429de84e6e931d5722bd59e4e0","6e0fdc687e70486aa055d090a32cb532","45d19e55c3c24d8db0e9219b9c840f8e","4f6b7e423b7847239fb12d3404a7e0f3","681918f95b184797b17d0d7dd93ec2e0","d7e7af1f69944a258c1b4b9f00cb2549","800e6f39a3e14624a53963e36a7bd480"]},"id":"ZUXTR6RJIRUL","executionInfo":{"status":"ok","timestamp":1648789566207,"user_tz":-540,"elapsed":6284275,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"dee5229c-9853-4b4d-e0a9-eb84081605cc"},"execution_count":23,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:11: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  # This is added back by InteractiveShellApp.init_path()\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"916e070fe0ed47f2a2a694c32a7d5b38"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"52d7ce9b0de44774b5faf57c5d6963db"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"f9d479d62a194925a6e5fd0efe4ccf1f"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"c0545689361746d1b688af6f069abc82"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"7c6a9aa8e4d6421fb92f2e46f960c84f"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"1d5816e45e584eac893d80084bf4316d"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"b1fd09e7b97c4ba6904fdac84b13f905"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"1a2086501916498c8c15f2d052b430cf"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"cdf6d6aee45741ba9fae4983149778c8"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/1841 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"6fb9106ff929471aa37de67be3c075c6"}},"metadata":{}}]},{"cell_type":"markdown","source":["# 번역 성능 측정 1 : BLEU Score"],"metadata":{"id":"KoolJJB3pGEK"}},{"cell_type":"markdown","source":["- n-gram을 통한 순서쌍들이 얼마나 겹치는지 측정 (precision)\n","- 문장길이에 대한 과적합 보정 (Brevity Penalty)\n","- 같은 단어가 연속적으로 나올 때 과적합 되는 것을 보정 (Clipping)"],"metadata":{"id":"_XBbXYM7pxUE"}},{"cell_type":"code","source":["!pip install nltk"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"o22aVlhGhMay","executionInfo":{"status":"ok","timestamp":1648791930229,"user_tz":-540,"elapsed":6420,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"19a211df-3db2-4245-a951-a34a6d948447"},"execution_count":24,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: nltk in /usr/local/lib/python3.7/dist-packages (3.2.5)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from nltk) (1.15.0)\n"]}]},{"cell_type":"code","source":["from nltk.translate.bleu_score import sentence_bleu\n","\n","reference = \"많 은 자연어 처리 연구자 들 이 트랜스포머를 선호 한다\".split()\n","candidate = \"적 은 자연어 학 개발자 들 가 트랜스포머를 선호 한다 요\".split()\n","\n","print(\"원문 :\", reference)\n","print(\"번역문 :\", candidate)\n","print(\"BLEU Score \", sentence_bleu([reference], candidate))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Ro5e5JA6qCrr","executionInfo":{"status":"ok","timestamp":1648792099227,"user_tz":-540,"elapsed":1032,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"ea096133-d06c-42ec-91bd-a67beccef4b6"},"execution_count":25,"outputs":[{"output_type":"stream","name":"stdout","text":["원문 : ['많', '은', '자연어', '처리', '연구자', '들', '이', '트랜스포머를', '선호', '한다']\n","번역문 : ['적', '은', '자연어', '학', '개발자', '들', '가', '트랜스포머를', '선호', '한다', '요']\n","BLEU Score  0.3672056269893592\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/nltk/translate/bleu_score.py:490: UserWarning: \n","Corpus/Sentence contains 0 counts of 4-gram overlaps.\n","BLEU scores might be undesirable; use SmoothingFunction().\n","  warnings.warn(_msg)\n"]}]},{"cell_type":"markdown","source":["![20220204_001230.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjAAAABHCAIAAACWK+poAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABK6SURBVHhe7Z1Na9tMtMfvV9GX0FJ4Y7KoV9YuIgtBF4YsDIFgHgimUEygmHAJphBEIZgHiikUHCg4ENDiAd1FcRZBWRR3EdRFQYuAFgEtArnzJlnvlhM7VpL/j1BqWZZHZ2bOf+bMGfl/HgAAAIAKAEECAABQCSBIAAAAKgEECQAAQCWAIAEAAKgEqxQk56wtvzNs8QoAAABYgtUJ0p9xW5YkCBIAAIBHsSpBcsZ7auMdBAkAAMAjWY0gOWdt/WQy3IUgAQAAeCSrEKS/k/b2YHrnjiFIAAAAHsvTBcmd7GmDS5/8B4IEAADg0TxVkLyLrnY8JXIEQQIAAPAUnihIrvlR03bEX12WJLmu7bRGv8TbAAAAQElWk9TAwAwJAADA41mRIF0NtR1VkQiKutMe/RaHAQAAgJKscIYEAAAAPB4I0ovH9zyWVAIAAJVmobOCIL1cvOk3o7+vylJr/FccAgCA6lHWWUGQXjiXAwmCBACoPiWcFQTphQNBAgC8CFYkSFNymdVwPBWXBKsCggQAeBGscobke7PzviqEhTK4FO9k4p61xHkEuT28dPx78RZYJRAkAMCLYJWCxLBPGkJjlhGkrokssLUBQQIAvAhWLkhRmSkvSMVngkfjXBjGgS5JjfYnY3TpiaMAAFAxSjqrXEFyLnrtL/ypqXMgSM+Jf2m0D01HvKogvn3a6f5wxSsAwBvFn35p9y5W4KuyBck5a8vNwfROvAyBID0v/vRYlffGldSkwrK59uxW/BcA8Pq5mw6acvvsqb4qS5BuRrqkGtfiVZTXJ0j+laHJknKUnAsW4k72FUlujW/E63ViG01J/VK5J9b6//VkuWumVMd3Z+Zph5i0dYaZE8W1jM42ew7+ltY6HNnQaW6TZr2+rdVrdf1gaKGlxPDMA1naHb88q1wbao5wlCctSPSh3fKhlemgX58g2V8axFdop8t4fM/skruqZbjjdUBdv6SP4uLHDZtGvL1u/OngnaR/jY+G6IqlXN9u6U1aEggSwTlrK3tMhO49+1uHPn1Ybo//iHffJu6PttzsW7zv/BkzN6EOrpD3JGD9XXqRgvTgW4fUVyVmSbSGsxBvx0kKkn85aEiNPJV7fYJE7vgxj4K7854xi9023knyp+whwkZglduZ5Ojx9JhWOgSJDVzqnX/tYAGXdVfC/uQN55/QxkwIYhLsN2sIByZycih3FpOjFypIdJLUkOT+E3xVQpB865MsyYO8+cJrFKQXAJ3GPamWV4sz0iVpb5LXYV6ZIHk3Tq6vvHXy3+NTRkrfEgfI4Jcd6L507/t4mzy4kz3qcdXP9isTpCfYJMSfHjXUJtvt+UIF6cmj54QgTQekteTE6wgQpI3AHJmcZ0YyqVWlwfM9A+MvDbNoiXhdhOUE6d61TjrqVl3brtebHeN8YrTrZEykfZ6S+yLXUZpaXW4NfwzpSoxc148t0bXvZuPDlrbNfqp4S20djmfzPs+eLSIrCmnMxxZdsdjRtKYib+ndb8QPerOzXosc2ZLJkUWpQb79WVX2Jxkn/Rm35cJY0910sE2+ojMJN14IiVq0b2wdNmG1JtUUhXz991loAaXZGfzn8G8kn1Jr5OKd4XWxP3mCTQj3vhcGJXyLSbTcvVjksPNt8n+0vSkqMUVrODnt8GodBCbxf497uxq1Cf1gq3cWaSbVsQnD/9lvNA37J2skZQTJI9Wtk4rWmvX6+97ofNTTya0onR8O64MbsYlvHVJfleeOFjqruCDdjDRajtwuug5B8qy+3qwrNeoavF/jnq4SOypb7eEVt5Iz2Sfvysru0HZpBahNTW22Y7a49+xzo8tNvFXXk6nSnmMOu7sq+aDWVHXSS1n2oPfTaJGKrNXbp3ywFoHbnXVs8m8nPIF0+I+6uqUoes9MrQS4l+PBvlrfor5P0bvDn0H1Xxo6OSLXSUPhbYhcU63J9bYxLbkKxULt2RpAmzu18bMJEh/m93+Kl2mWESQexWrxZRXnO20z3QvH/CDL28MZPeaZH+jVpHf96W/WVaQ2m5qxqbwkNU7YZJ4bIZ4X6l3QlT5JlhWRCuizS8natqoe83jRbLhDjiTX51J4GfmE3MtcpjtkEc43MrWk3bVwxXKNNpmdkv5NTCLHLaBq24rIj7pj66OLp+OrsYnzjRZf/bBwb8Mim/BlXXLvR9MZ9zx8Bu9bfWYSvgZBk4fJ14l7F1TFJjRLjekWH7UsFiQWqCBtgNYvnVqRMg9/2cOmpHxk080N2YTVjpbdp3ibXEKQmC0KRiurF6Rbsyt3Jrdi5i6/N3jE3f5M7Es9BenDxKB8YEjeb393XKuvkbsKQkb+71GnRj44CHJ1qO3a4eaYu9loX5FqnfENsZxv/9siyk/e9a8GKu2r/Ht5fw5hUYVd3rBYQp0Y0pLjrD5YYeTPUa/iWUeaLGt9U1yIlZ8Pi8gclnycf5FChHb0i90h0/6yc1vetjKeBGgb273Rv8TUZQRpNmoziV38V/Sbv6xmc1cZCUsIEh+OtYI+zJe4412RX42LsXttWdf8TeF85cAm/BkisS8VbWa+1iXaZORX9vnF560ll7iveZQa0cpi6R4LcibXaZM8C0SWtXhDlQdX4nU+T7GJPSTNbIuWVv8crrHls9gm/HmbzA/eu7Zl2YFJmPMNowt8BSs2Q62GTegES3j/koJ0SYNZ0lHQ73/2aRFjLmIzNuEDwSyfX8pZxQSJl6NAP0RBGUUyU/pM77zDIoRTak6pawajOf7xxpeL0Q71ffwmWe6fZx7QU9VTNlikekZezZ2OR6YjcjsIkjhjGrAOMxFtVodEJ4jMyL3//IfbSYccSNS9O2mTg/tcpNzJgdY6ZDpzbTRYAgnr59EAGt2RQ47E/BpvVaTApN1Q7eS1HmmdWY6G56C3vseKw2BtK9lGyfe2yAWZrZ5vhsSaZlHQibfdUoKU6Hvc78TvhV+NVlaCe292PfOC1BLR3qIdMtWx0+csUdTQ1zxSjcS4PjuqE2WdNilhAe5oFvTugKfaxPs1IkNmeTtIustjsU248+1ljO9uZ/bvUPIy7q4SNrk2VDHXyWi3mSSLnfGpDdmElSTVp8o6qw0L0sMdCyfT3IzYwqb9mUqH9L8XtkXjm9Mj+kqEiWgMWtiYJW0TLagHQ/tW92QSbvWgakeIJjXd+zw7jl+Ch1A65/P3KWIEQVDU3e58lwT5DGkx/N3I2IFl38ePkLP48jVpH/xTbD4UbS5CYiNVTvljDU9GWXG8LEG6GsjbncGJ0d8jRtC7J8/0TAfWNJcUpBvTODFif3zlhu54oxcLR5S00cTTRvnVcpqQ716b41Ojf9Diw+1oF0p30RLdrBjP+lSXpHr/v3iDKQELnUvqpyCKT651OUrYRDxPZZ02KWGBpZwv4fE24YgwJgstPsEm3PnmeDrftc3x8KTf3dXojrD43VXAJs5Ib/R/BroRb7d5NhFeKjFDikVcNmSTTEEq7aw2LUgMPniM3IMzoiHLMHjIpxfp3CR3skdPS968QJgs510CC8JmjSC8n0abd2ZKbMWVt4Pocs70mJ6ZkBZ+MGwu3BqRT7GlvyUy57IEKYBdvGjQsVpY01xSkHgfiyLMxfYAkqvN1waS69v8aukmxEO1Uq1lnNuO5zu8vUVrYeWCxMa8rV02/l0q6Z9+UG5/nUUrO9pBOEEx1miTEhZY0vkubxPvd/wpHkHbIPf4BJvkOV9/xrZ/KbvG5JqaJH13G7eJ81WP7fuMt9t8m7AIcHwNKR5I35BNMgUpgF25yFnFBGnhenXUOsXVU/5M1trIWZFlCTElDwJxiQjynOKGwusjf7WDTcv4mMIPtyJ5jnk2FnMs37O/skW4ecV4k33ymi2Di3maKEO8e3AFbQQTdn6DkSgfDxVyPeJzxAfHPOy03zeUD5n5ryykmZX96FwYvfekjGVmSKtZQ3K+ksmecA2ZLOPlyZBCbf8TyZ5K7drPdr5/J6xi5sWYdyFhz1UL0jwCs+TznLzpoEkTn8RLOtjKWfIVrNEmJSywjPNd3iZiPsR7ECcQpMKVvIU2yXa+dBMuOSzWg+mB8O7CMMumbSIunk3OGJTi24Om3jmYZ9mN+eL0nA3ZhM3VMuLJ5ZxVPKmBTKwK+6coKKO4esqfSWYLLLzVD++eDBnI6zDZj0e3GllLwTxkl1BQ50e3d0FugU+AkmN57+dozDL02CSGyVWwOESV4wOtrHnCAgsOzGN6XBppDJAoE9cTsZIcvUdSYHIokrjCV8jmUzFuHJYNRWfrpAzkiP7Ftomvb/bnYZ0Q9r3xNIqNQRp04n4TLOHl6XJdkbYRMp2vaF2R7son2aQLkfPFV69QkOZehlNak1jqVDeaWU7HIoX7kNZpkxIWKO18H2UTNpohTTlc5Q2KlPUYqjmLbZLpfMW9RO7O4UPdwSU5X3iGjdskQboes6G+eu4zs9iMTdhnyySAZBMXJJbNVeD4REEZxdVT/kyxgBQs+HtXhs62F4R9loe/MiWXjwppGh5/6bvWZ115b9hseZALwzyLnbx70qqLRD4e7utP753xnhoEcJkghZmy96552JCaxtwcXLC/O3RJIBxisDWkxpHQEdca6LKsfYwMAdIrZExHiVm8867C0gVnP4bWXzqvCjYMxmHfm4jbbAx2OwXjWesTuTmp9a1MN6T73uT3vSA+Phyblv0nZoDY8mEIX1QIH8NDHQE9TToyzcPAUGykRrpYWA7hoMOwe3Dxgn0OlKSX4ZTxNTynJkV8uTHFGm1SwgLCPRWESSiPtsmt2a1J2pHl8C7mmn2aeRidQWay0CZ8zJd00HxCFhbJ+S5M0jfNXjAs2LxN4ojyZASE4rBBqrrfD2wymljT2e3mbcKW/x+/9TsuSHxWkS/O6xAkPmjSP/RaNbqTq65H8ggofD0p9w7pJq/3ZBbPNiHtdodmbE90+BhHranSDIXIu/71kHxjvan3ziNV79lDvpdoR1ObWodMLXnPETjmR03Zqqu7w2iyqnc16vIykLf2B+PLmP2IysuSEruBv2ZPV5QtVf1nxDdFUaijz95Ax4y5cLvMc8GW0ZLpGIQg9hKnaLWJMPuXdo8EdM8ZMUPqgtGG5P2aDPZVheez7BuWS6uGlKv+z8QRY8M5rePBvDkyBsfJU3LK6ZofW0bSy3D86UmrVzBKyDZI0cZzzlpsIsLgc9IWGBwnT0nVMecJNiF4s8lxR62xbyBF3TfMm8LzGQU24YP3CNFie7PzQYfuiaY9unNiuX/M3jY1CZXA6tiEEfWZgqJ5kmce1sVpc+hQmHxkczZhM6d4Ds5SJASJ62fuY8rWIEh86lcQVfcdczwWm2RfMzSb/N1gemMNz2Or36QB0YWrJ9TxqmFRygXD/FKwxtYaRmPfdw6Z45IhViQ48LaATdLAJil4H+wF+x4p/q09/kD3nxR75vXCVsf1UtGRbJKCxK+YzIQOWL0g8QWk/EdNvBnoHqnG8XR6ovcS2aK0Rko8W+U5oZO5/GyRsrCxSEZogoUa0jOwNwFskgY2ScNiAJGQmoCteW9QpOlOm+LlwEWkBImMR77qeePf1QsS32+MZ/0++PaJJtfUVuonYunMqULTIw57lEt0g9ej8MyuIimdb5FHafmu+UmdL4S8PWCTNLBJGvs09mgYyq092ossgW8Augqe/FWaJckQJCJJZEiSed2VChLPggupzBpJpbg21Gr2urtp/x172sUTca3RYUdrqnTZY1tVt1vd0/gy4BsENkkDm6Twfk2Mg5bKbdJU1Z3O4GzqLrVDbqXYX5ZOKUyTKUgiXTWVMbKGGRIoIKcWqsKfcbv2doeoAIAQmni8islZjiARIk/oCYEgPSv8sUNVpvolBACsH6oWq5ic5QtSFvz5wZy8xAdO9MyuWdUxPgAAgMpQWpB8b3bep08RDZHbw0snQxXTZ9Y62WcCAAAAAWUEKbnNMMl899aiM99ojiYAAIDFLBeyAwAAANYEBAkAAEAlgCABAACoBBAkAAAAlQCCBAAAoBJAkAAAAFSCpQTJnewrUm0Q/hJqCXzvetxtPv3J0AAAAF45SwmSb383Ur/Wk4t70dN2u729hvilcAAAACCftYfs2EPtIEgAAAAWUFaQ/OthZ7+ly9pwSWmBIAEAAChDOUHypwO9a95YPUnmP0/rWkPjxMj9i/zIHAQJAABAGcoJEtGfM9u96Epye/JXHCsJBAkAAEAZyq8heZN9Sd6bLPtz7RAkAAAAZSgtSLeTjiS1zhz7bDS9RcgOAADAiikrSO6PNtGj8fWko49m4lgpIEgAAADKUHqG9HfSqcn17c7wuvS22KuhtqOpNfpDSPKWpu30LfzcNQAAgBzKryEBAAAAawSCBAAAoBJAkAAAAFQCCBIAAIBKAEECAABQCSBIAAAAKsDDw/8DO4sk8rwjDNUAAAAASUVORK5CYII=)"],"metadata":{"id":"BnJKA8QgrCQa"}},{"cell_type":"code","source":["print(\"1-gram :\", sentence_bleu([reference], candidate, weights= [1, 0, 0, 0]))\n","print(\"2-gram :\", sentence_bleu([reference], candidate, weights= [0, 1, 0, 0]))\n","print(\"3-gram :\", sentence_bleu([reference], candidate, weights= [0, 0, 1, 0]))\n","print(\"4-gram :\", sentence_bleu([reference], candidate, weights= [0, 0, 0, 1]))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qXNjPg4-qtMn","executionInfo":{"status":"ok","timestamp":1648792415541,"user_tz":-540,"elapsed":247,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"d91d1f1e-1eef-4c43-cf0a-46c8a0703f74"},"execution_count":26,"outputs":[{"output_type":"stream","name":"stdout","text":["1-gram : 0.5454545454545454\n","2-gram : 0.3\n","3-gram : 0.11111111111111109\n","4-gram : 1.0\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/nltk/translate/bleu_score.py:490: UserWarning: \n","Corpus/Sentence contains 0 counts of 4-gram overlaps.\n","BLEU scores might be undesirable; use SmoothingFunction().\n","  warnings.warn(_msg)\n"]}]},{"cell_type":"code","source":["from nltk.translate.bleu_score import SmoothingFunction\n","\n","def calculate_bleu(reference, candidate, weights=[0.25, 0.25, 0.25, 0.25]):\n","    return sentence_bleu([reference],\n","                         candidate,\n","                         weights = weights,\n","                         smoothing_function=SmoothingFunction().method1)\n","\n","print(\"BLEU-1 :\", calculate_bleu(reference, candidate, weights=[1, 0, 0, 0]))\n","print(\"BLEU-2 :\", calculate_bleu(reference, candidate, weights=[0, 1, 0, 0]))\n","print(\"BLEU-3 :\", calculate_bleu(reference, candidate, weights=[0, 0, 1, 0]))\n","print(\"BLEU-4 :\", calculate_bleu(reference, candidate, weights=[0, 0, 0, 1]))\n","\n","print(\"\\nBLEU-Total :\", calculate_bleu(reference, candidate))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"iDaO_KnEr6mw","executionInfo":{"status":"ok","timestamp":1648792844972,"user_tz":-540,"elapsed":249,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"ce4965e3-93f1-461e-ee80-17640cbdfb05"},"execution_count":27,"outputs":[{"output_type":"stream","name":"stdout","text":["BLEU-1 : 0.5454545454545454\n","BLEU-2 : 0.3\n","BLEU-3 : 0.11111111111111109\n","BLEU-4 : 0.012500000000000006\n","\n","BLEU-Total : 0.12278260149096115\n"]}]},{"cell_type":"code","source":["def evaluate(sentence, model, src_tokenizer, tgt_tokenizer):\n","    sentence = preprocess_sentence(sentence)\n","\n","    pieces = src_tokenizer.encode_as_pieces(sentence)\n","    tokens = src_tokenizer.encode_as_ids(sentence)\n","\n","    _input = tf.keras.preprocessing.sequence.pad_sequences([tokens],\n","                                                           maxlen=enc_train.shape[-1],\n","                                                           padding='post')\n","    \n","    ids = []\n","    output = tf.expand_dims([tgt_tokenizer.bos_id()], 0)\n","    for i in range(dec_train.shape[-1]):\n","        enc_padding_mask, combined_mask, dec_padding_mask = \\\n","        generate_masks(_input, output)\n","\n","        predictions, enc_attns, dec_attns, dec_enc_attns =\\\n","        model(_input, \n","              output,\n","              enc_padding_mask,\n","              combined_mask,\n","              dec_padding_mask)\n","\n","        predicted_id = \\\n","        tf.argmax(tf.math.softmax(predictions, axis=-1)[0, -1]).numpy().item()\n","\n","        if tgt_tokenizer.eos_id() == predicted_id:\n","            result = tgt_tokenizer.decode_ids(ids)\n","            return pieces, result, enc_attns, dec_attns, dec_enc_attns\n","\n","        ids.append(predicted_id)\n","        output = tf.concat([output, tf.expand_dims([predicted_id], 0)], axis=-1)\n","\n","    result = tgt_tokenizer.decode_ids(ids)\n","\n","    return pieces, result, enc_attns, dec_attns, dec_enc_attns"],"metadata":{"id":"p4JlMv4otjdp","executionInfo":{"status":"ok","timestamp":1648793015099,"user_tz":-540,"elapsed":257,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":28,"outputs":[]},{"cell_type":"code","source":["def translate(sentence, model, src_tokenizer, tgt_tokenizer):\n","    pieces, result, enc_attns, dec_attns, dec_enc_attns = \\\n","    evaluate(sentence, model, src_tokenizer, tgt_tokenizer)\n","\n","    return result"],"metadata":{"id":"tcJDREW5uM9R","executionInfo":{"status":"ok","timestamp":1648793025542,"user_tz":-540,"elapsed":278,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":29,"outputs":[]},{"cell_type":"code","source":["def eval_bleu(src_corpus, tgt_corpus, verbose=True):\n","    total_score = 0.0\n","    sample_size = len(tgt_corpus)\n","\n","    for idx in tqdm_notebook(range(sample_size)):\n","        src_tokens = src_corpus[idx]\n","        tgt_tokens = tgt_corpus[idx]\n","\n","        src_sentence = tokenizer.decode_ids((src_tokens.tolist()))\n","        tgt_sentence = tokenizer.decode_ids((tgt_tokens.tolist()))\n","\n","        reference = preprocess_sentence(tgt_sentence).split()\n","        candidate = translate(src_sentence, transformer, tokenizer, tokenizer).split()\n","\n","        score = sentence_bleu([reference], candidate,\n","                              smoothing_function = SmoothingFunction().method1)\n","        \n","        total_score += score\n","\n","        if verbose:\n","            print(\"Source Sentence: \", src_sentence)\n","            print(\"Model Prediction :\", candidate)\n","            print(\"Real :\", reference)\n","            print(\"Score : %lf\\n\" % score)\n","\n","    print(\"Num of Sample :\", sample_size)\n","    print(\"Total Score :\", total_score/sample_size)"],"metadata":{"id":"WrSu8gsBuPif","executionInfo":{"status":"ok","timestamp":1648793495347,"user_tz":-540,"elapsed":237,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":32,"outputs":[]},{"cell_type":"code","source":["eval_bleu(enc_val[::10], dec_val[::10], verbose=False)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":143,"referenced_widgets":["ee21c77480ce4147bb24861f81940295","25df50d65d3447639397b10d2093bbbd","44f02039a2074432a16ad161494e5b49","d6fd4e1cd335428383b91c47c2a596c3","81f51765100849a39b9e4079a11254ae","fe06870ebef946409b0ad8813084a33d","313da4a60155495db0e4cb0df656c6f5","615199aa02874734a15beef02a790f25","dcd9b0abf91d415aa4d2421c7747f078","0008a727199b4e69a9d1e1d987935e23","a7715cc2ac6440078ed05d36fd316483"]},"id":"0YKt8R4eviIY","executionInfo":{"status":"ok","timestamp":1648794257811,"user_tz":-540,"elapsed":659184,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"b85590ee-b138-42e6-fc66-9ea0da41f72e"},"execution_count":34,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:5: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  \"\"\"\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/119 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"ee21c77480ce4147bb24861f81940295"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Num of Sample : 119\n","Total Score : 4.188217977587736e-05\n"]}]},{"cell_type":"markdown","source":["# 번역 성능 측정 2 : Beam Serch Decoder"],"metadata":{"id":"61Y5ifck01HJ"}},{"cell_type":"code","source":["import math\n","\n","def beam_search_decoder(prob, beam_size):\n","    sequences = [[[], 1.0]]  # 생성된 문장과 점수를 저장\n","\n","    for tok in prob:\n","        all_candidates = []\n","\n","        for seq, score in sequences:\n","            for idx, p in enumerate(tok): # 각 단어의 확률을 총점에 누적 곱\n","                candidate = [seq + [idx], score * -math.log(-(p-1))]\n","                all_candidates.append(candidate)\n","\n","        ordered = sorted(all_candidates,\n","                         key=lambda tup:tup[1],\n","                         reverse=True) # 총점 순 정렬\n","        sequences = ordered[:beam_size] # Beam Size에 해당하는 문장만 저장 \n","\n","    return sequences"],"metadata":{"id":"L76XWEUlvp9A","executionInfo":{"status":"ok","timestamp":1648794545341,"user_tz":-540,"elapsed":254,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":35,"outputs":[]},{"cell_type":"code","source":["vocab = {\n","    0: \"<pad>\",\n","    1: \"까요?\",\n","    2: \"커피\",\n","    3: \"마셔\",\n","    4: \"가져\",\n","    5: \"될\",\n","    6: \"를\",\n","    7: \"한\",\n","    8: \"잔\",\n","    9: \"도\",\n","}\n","\n","prob_seq = [[0.01, 0.01, 0.60, 0.32, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],\n","            [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.75, 0.01, 0.01, 0.17],\n","            [0.01, 0.01, 0.01, 0.35, 0.48, 0.10, 0.01, 0.01, 0.01, 0.01],\n","            [0.24, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.68],\n","            [0.01, 0.01, 0.12, 0.01, 0.01, 0.80, 0.01, 0.01, 0.01, 0.01],\n","            [0.01, 0.81, 0.01, 0.01, 0.01, 0.01, 0.11, 0.01, 0.01, 0.01],\n","            [0.70, 0.22, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],\n","            [0.91, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],\n","            [0.91, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],\n","            [0.91, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01]]\n","\n","prob_seq = np.array(prob_seq)\n","beam_size = 3\n","\n","result = beam_search_decoder(prob_seq, beam_size)\n","\n","for seq, score in result:\n","    sentence = \"\"\n","\n","    for word in seq:\n","        sentence += vocab[word] + \" \"\n","\n","    print(sentence, \"// Score: %.4f\" % score)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dx7_FcVm0Cjq","executionInfo":{"status":"ok","timestamp":1648794552040,"user_tz":-540,"elapsed":231,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"3d3a379c-4884-4252-a4b9-b5924fb60dc3"},"execution_count":36,"outputs":[{"output_type":"stream","name":"stdout","text":["커피 를 가져 도 될 까요? <pad> <pad> <pad> <pad>  // Score: 42.5243\n","커피 를 마셔 도 될 까요? <pad> <pad> <pad> <pad>  // Score: 28.0135\n","마셔 를 가져 도 될 까요? <pad> <pad> <pad> <pad>  // Score: 17.8983\n"]}]},{"cell_type":"code","source":["def calc_prob(src_ids, tgt_ids, model):\n","    enc_padding_mask, combined_mask, dec_padding_mask = \\\n","    generate_masks(src_ids, tgt_ids)\n","\n","    predictions, enc_attns, dec_attns, dec_enc_attns =\\\n","    model(src_ids, \n","            tgt_ids,\n","            enc_padding_mask,\n","            combined_mask,\n","            dec_padding_mask)\n","    \n","    return tf.math.softmax(predictions, axis=-1)"],"metadata":{"id":"lVvjHPu_0ENT","executionInfo":{"status":"ok","timestamp":1648794558448,"user_tz":-540,"elapsed":248,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":37,"outputs":[]},{"cell_type":"code","source":["def beam_search_decoder(sentence, \n","                        src_len,\n","                        tgt_len,\n","                        model,\n","                        src_tokenizer,\n","                        tgt_tokenizer,\n","                        beam_size):\n","    sentence = preprocess_sentence(sentence)\n","\n","    pieces = src_tokenizer.encode_as_pieces(sentence)\n","    tokens = src_tokenizer.encode_as_ids(sentence)\n","\n","    src_in = tf.keras.preprocessing.sequence.pad_sequences([tokens],\n","                                                            maxlen=src_len,\n","                                                            padding='post')\n","\n","    pred_cache = np.zeros((beam_size * beam_size, tgt_len), dtype=np.long)\n","    pred = np.zeros((beam_size, tgt_len), dtype=np.long)\n","\n","    eos_flag = np.zeros((beam_size, ), dtype=np.long)\n","    scores = np.ones((beam_size, ))\n","\n","    pred[:, 0] = tgt_tokenizer.bos_id()\n","\n","    dec_in = tf.expand_dims(pred[0, :1], 0)\n","    prob = calc_prob(src_in, dec_in, model)[0, -1].numpy()\n","\n","    for seq_pos in range(1, tgt_len):\n","        score_cache = np.ones((beam_size * beam_size, ))\n","\n","        # init\n","        for branch_idx in range(beam_size):\n","            cache_pos = branch_idx*beam_size\n","\n","            score_cache[cache_pos:cache_pos+beam_size] = scores[branch_idx]\n","            pred_cache[cache_pos:cache_pos+beam_size, :seq_pos] = \\\n","            pred[branch_idx, :seq_pos]\n","\n","        for branch_idx in range(beam_size):\n","            cache_pos = branch_idx*beam_size\n","\n","            if seq_pos != 1:   # 모든 Branch를 로 시작하는 경우를 방지\n","                dec_in = pred_cache[branch_idx, :seq_pos]\n","                dec_in = tf.expand_dims(dec_in, 0)\n","\n","                prob = calc_prob(src_in, dec_in, model)[0, -1].numpy()\n","\n","            for beam_idx in range(beam_size):\n","                max_idx = np.argmax(prob)\n","\n","                score_cache[cache_pos+beam_idx] *= prob[max_idx]\n","                pred_cache[cache_pos+beam_idx, seq_pos] = max_idx\n","\n","                prob[max_idx] = -1\n","\n","        for beam_idx in range(beam_size):\n","            if eos_flag[beam_idx] == -1: continue\n","\n","            max_idx = np.argmax(score_cache)\n","            prediction = pred_cache[max_idx, :seq_pos+1]\n","\n","            pred[beam_idx, :seq_pos+1] = prediction\n","            scores[beam_idx] = score_cache[max_idx]\n","            score_cache[max_idx] = -1\n","\n","            if prediction[-1] == tgt_tokenizer.eos_id():\n","                eos_flag[beam_idx] = -1\n","\n","    return pred"],"metadata":{"id":"xPaGbJ200FwI","executionInfo":{"status":"ok","timestamp":1648794564428,"user_tz":-540,"elapsed":273,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":38,"outputs":[]},{"cell_type":"code","source":["from nltk.translate.bleu_score import sentence_bleu\n","from nltk.translate.bleu_score import SmoothingFunction\n","\n","def calculate_bleu(reference, candidate, weights=[0.25, 0.25, 0.25, 0.25]):\n","    return sentence_bleu([reference],\n","                            candidate,\n","                            weights=weights,\n","                            smoothing_function=SmoothingFunction().method1)\n","\n","def beam_bleu(reference, ids, tokenizer):\n","    reference = reference.split()\n","\n","    total_score = 0.0\n","    for _id in ids:\n","        candidate = tokenizer.decode_ids(_id.tolist()).split()\n","        score = calculate_bleu(reference, candidate)\n","\n","        print(\"Reference:\", reference)\n","        print(\"Candidate:\", candidate)\n","        print(\"BLEU:\", calculate_bleu(reference, candidate))\n","\n","        total_score += score\n","        \n","    return total_score / len(ids)\n"],"metadata":{"id":"yophZkeh0HPC","executionInfo":{"status":"ok","timestamp":1648794570041,"user_tz":-540,"elapsed":259,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":39,"outputs":[]},{"cell_type":"code","source":["idx = 324\n","\n","ids = \\\n","beam_search_decoder(tokenizer.decode_ids(enc_val[idx].tolist()),\n","                    enc_train.shape[-1],\n","                    dec_train.shape[-1],\n","                    transformer,\n","                    tokenizer,\n","                    tokenizer,\n","                    beam_size=3)\n","\n","bleu = beam_bleu(tokenizer.decode_ids(dec_val[idx].tolist()), ids, tokenizer)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Ei9HNe0h0Imv","executionInfo":{"status":"ok","timestamp":1648795409297,"user_tz":-540,"elapsed":20952,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"b37fc1eb-87fb-4bac-dde9-6ccaad752078"},"execution_count":41,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:17: DeprecationWarning: `np.long` is a deprecated alias for `np.compat.long`. To silence this warning, use `np.compat.long` by itself. In the likely event your code does not need to work on Python 2 you can use the builtin `int` for which `np.compat.long` is itself an alias. Doing this will not modify any behaviour and is safe. When replacing `np.long`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.\n","Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations\n","/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:18: DeprecationWarning: `np.long` is a deprecated alias for `np.compat.long`. To silence this warning, use `np.compat.long` by itself. In the likely event your code does not need to work on Python 2 you can use the builtin `int` for which `np.compat.long` is itself an alias. Doing this will not modify any behaviour and is safe. When replacing `np.long`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.\n","Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations\n","/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:20: DeprecationWarning: `np.long` is a deprecated alias for `np.compat.long`. To silence this warning, use `np.compat.long` by itself. In the likely event your code does not need to work on Python 2 you can use the builtin `int` for which `np.compat.long` is itself an alias. Doing this will not modify any behaviour and is safe. When replacing `np.long`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.\n","Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations\n"]},{"output_type":"stream","name":"stdout","text":["Reference: ['ella', 'no', 'distingue', 'lo', 'correcto', 'de', 'lo', 'incorrecto', '.......................................']\n","Candidate: []\n","BLEU: 0\n","Reference: ['ella', 'no', 'distingue', 'lo', 'correcto', 'de', 'lo', 'incorrecto', '.......................................']\n","Candidate: ['desp']\n","BLEU: 0\n","Reference: ['ella', 'no', 'distingue', 'lo', 'correcto', 'de', 'lo', 'incorrecto', '.......................................']\n","Candidate: ['desp']\n","BLEU: 0\n"]}]},{"cell_type":"markdown","source":["## Data Augmentation"],"metadata":{"id":"q_SmMU7P3krK"}},{"cell_type":"markdown","source":["- Lexical Substitution\n","- Back Translation\n","- Random Noise Injection"],"metadata":{"id":"BF0OKpTx48zm"}},{"cell_type":"code","source":["!pip install gensim"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"NHufpj700XxS","executionInfo":{"status":"ok","timestamp":1648796045378,"user_tz":-540,"elapsed":6635,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"8745c673-6503-4a5e-a9cf-d5c402614ae8"},"execution_count":42,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: gensim in /usr/local/lib/python3.7/dist-packages (3.6.0)\n","Requirement already satisfied: numpy>=1.11.3 in /usr/local/lib/python3.7/dist-packages (from gensim) (1.21.5)\n","Requirement already satisfied: scipy>=0.18.1 in /usr/local/lib/python3.7/dist-packages (from gensim) (1.4.1)\n","Requirement already satisfied: six>=1.5.0 in /usr/local/lib/python3.7/dist-packages (from gensim) (1.15.0)\n","Requirement already satisfied: smart-open>=1.2.1 in /usr/local/lib/python3.7/dist-packages (from gensim) (5.2.1)\n"]}]},{"cell_type":"code","source":["import gensim.downloader as api\n","wv = api.load('glove-wiki-gigaword-300')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"UDKHwjNF5vTs","executionInfo":{"status":"ok","timestamp":1648796338924,"user_tz":-540,"elapsed":238553,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"aec11fb3-6d7a-454a-899a-d7443892357e"},"execution_count":43,"outputs":[{"output_type":"stream","name":"stdout","text":["[==================================================] 100.0% 376.1/376.1MB downloaded\n"]}]},{"cell_type":"code","source":["wv.most_similar(\"banana\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"S9lgmE665-SU","executionInfo":{"status":"ok","timestamp":1648796415006,"user_tz":-540,"elapsed":965,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"7ba86f54-dbc0-4ded-9753-505095c94f71"},"execution_count":44,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[('bananas', 0.6691170930862427),\n"," ('mango', 0.580410361289978),\n"," ('pineapple', 0.5492371916770935),\n"," ('coconut', 0.5462779402732849),\n"," ('papaya', 0.541056752204895),\n"," ('fruit', 0.5218108296394348),\n"," ('growers', 0.4877638816833496),\n"," ('nut', 0.4839959144592285),\n"," ('peanut', 0.48062020540237427),\n"," ('potato', 0.4806118607521057)]"]},"metadata":{},"execution_count":44}]},{"cell_type":"code","source":["import random\n","\n","sample_sentence = \"you know ? all you need is attention .\"\n","sample_tokens = sample_sentence.split()\n","\n","selected_tok = random.choice(sample_tokens)\n","\n","result = \"\"\n","for tok in sample_tokens:\n","    if tok is selected_tok:\n","        result += wv.most_similar(tok)[0][0] + \" \"\n","\n","    else:\n","        result += tok + \" \"\n","\n","print(\"From :\", sample_sentence)\n","print(\"To :\", result)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"fXLMl2vZ7K3E","executionInfo":{"status":"ok","timestamp":1648796568506,"user_tz":-540,"elapsed":247,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"cc5af74e-6840-4674-dc25-09092e21779b"},"execution_count":45,"outputs":[{"output_type":"stream","name":"stdout","text":["From : you know ? all you need is attention .\n","To : you know ? all you need is focus . \n"]}]},{"cell_type":"markdown","source":["### Lexical Substitution 구현"],"metadata":{"id":"6E2-FXiY8DIu"}},{"cell_type":"markdown","source":["- 입력된 문장을 Embedding유사도 기반으로 Augmentation하여 반환하는 lexical_sub()구현하기\n","- 구현한 함수를 활용해 3000개의 영문 데이터를 Augmentation하고 결과를 확인하기!\n","- 단어장에 포함되지 않은 단어가 들어올 경우, 문장 부호에 대한 치환이 발생하는 경우등의 예외는 자유롭게 처리"],"metadata":{"id":"HIjeikq08G-N"}},{"cell_type":"code","source":["def lexical_sub(sentence, word2vec):\n","    import random\n","\n","    res = \"\"\n","\n","    toks = sentence.split()\n","    \n","    try:\n","        _from = random.choice(toks)\n","        _to = word2vec.most_similar(_from)[0][0]\n","\n","    except: # 단어장에 없는 단어\n","        return None\n","\n","    for tok in toks:\n","        if tok is _from: res += _to + \" \"\n","        else: res += tok + \" \"\n","\n","    return res"],"metadata":{"id":"jEBZ8TG47wdi","executionInfo":{"status":"ok","timestamp":1648796872008,"user_tz":-540,"elapsed":248,"user":{"displayName":"백혜림","userId":"01884416935170274848"}}},"execution_count":46,"outputs":[]},{"cell_type":"code","source":["from tqdm import tqdm_notebook\n","\n","new_corpus = []\n","\n","for idx in tqdm_notebook(range(3000)):\n","    old_src = tokenizer.decode_ids(src_corpus[idx])\n","    new_src = lexical_sub(old_src, wv)\n","\n","    if new_src is not None : new_corpus.append(new_src)\n","    new_corpus.append(old_src)\n","\n","print(new_corpus[:10])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":144,"referenced_widgets":["5407552467424353983ac3cc51fd985f","191a010075384ee383bd3a25f48a1441","655eb8ebcdbb4597ac3103d641557e4b","bdea086e18494fda94494e53c7ef1b94","4d7381fdb414474ca9319a209a0a3422","b83425ba162744b2a1d6a649e6631618","a8f945bb5f374fb2b649001739a8d603","325a2d65a99d4d47b10e3f630d2c993e","a6bc8aaec7564ab6bac643e647a1455f","e93d01a9c2834a73a4de9ab6d08b706b","e9937f59a4be49f3b43c6becbad12e7a"]},"id":"4Em8Rq4V86nS","executionInfo":{"status":"ok","timestamp":1648797178327,"user_tz":-540,"elapsed":179464,"user":{"displayName":"백혜림","userId":"01884416935170274848"}},"outputId":"128515ad-6509-44d9-d076-5e686d5583a8"},"execution_count":47,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:5: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\n","Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n","  \"\"\"\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/3000 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"5407552467424353983ac3cc51fd985f"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["['tom has no one to turning to for help . ', 'tom has no one to turn to for help .', 'tom could be canada . ', 'tom could be canadian .', 'you could start your their company . ', 'you could start your own company .', \"did 'd give you that impression ? \", 'did i give you that impression ?', 'my companions were those asleep . ', 'my companions were all asleep .']\n"]}]},{"cell_type":"code","source":[""],"metadata":{"id":"y59Rc2VF9ZrL"},"execution_count":null,"outputs":[]}]}